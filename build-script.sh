
#!/bin/bash

echo "๐ ุณุงุฎุช ุฏุฌโฺฉุชุงุจ ุจุฑุง ูุจ ู ุงูุฏุฑูุฏ"

# ุจุฑุฑุณ ูุฌูุฏ Node.js
if ! command -v node &> /dev/null; then
    echo "โ Node.js ูุตุจ ูุดุฏู ุงุณุช. ูุทูุงู ุงุจุชุฏุง Node.js ูุตุจ ฺฉูุฏ."
    exit 1
fi

# ุจุฑุฑุณ ูุฌูุฏ npm
if ! command -v npm &> /dev/null; then
    echo "โ npm ูุตุจ ูุดุฏู ุงุณุช."
    exit 1
fi

echo "๐ฆ ูุตุจ ูุงุจุณุชฺฏโูุง..."
npm install

# ุณุงุฎุช ูุณุฎู ูุจ
echo "๐ฑ ุณุงุฎุช ูุณุฎู ูุจ..."
npm run build

# ุจุฑุฑุณ ููููุช ุณุงุฎุช
if [ ! -d "dist" ]; then
    echo "โ ุฎุทุง ุฏุฑ ุณุงุฎุช ูุณุฎู ูุจ"
    exit 1
fi

# ุงุฌุงุฏ ูพูุดู ุฎุฑูุฌ
echo "๐ ุงุฌุงุฏ ูพูุดู ุฎุฑูุฌ..."
mkdir -p release

# ฺฉูพ ูุงูโูุง ูุจ
echo "๐ฆ ุจุณุชูโุจูุฏ ูุณุฎู ูุจ..."
cp -r dist release/web
cd release && zip -r digiketab-web.zip web && cd ..

echo "โ ูุณุฎู ูุจ ุขูุงุฏู ุงุณุช: release/digiketab-web.zip"

# ุขูุงุฏูโุณุงุฒ ุจุฑุง ุงูุฏุฑูุฏ
echo "๐ง ุขูุงุฏูโุณุงุฒ ุจุฑุง ุงูุฏุฑูุฏ..."

# ุจุฑุฑุณ ูุตุจ Capacitor
if ! npm list @capacitor/core &> /dev/null; then
    echo "๐ฑ ูุตุจ Capacitor..."
    npm install @capacitor/core @capacitor/cli @capacitor/android
fi

# ุงุถุงูู ฺฉุฑุฏู ูพูุชูุฑู ุงูุฏุฑูุฏ (ุงฺฏุฑ ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏ)
if [ ! -d "android" ]; then
    echo "๐ฑ ุงุถุงูู ฺฉุฑุฏู ูพูุชูุฑู ุงูุฏุฑูุฏ..."
    npx cap add android
fi

# ฺฉูพ ูุงูโูุง ูุจ ุจู ุงูุฏุฑูุฏ
echo "๐ฑ ฺฉูพ ูุงูโูุง ุจู ูพูุชูุฑู ุงูุฏุฑูุฏ..."
npx cap copy

echo "
๐ ููู ฺุฒ ุขูุงุฏู ุงุณุช!

๐ ูุงูโูุง ุขูุงุฏู:
   โ ูุจ: release/digiketab-web.zip
   โ ุงูุฏุฑูุฏ: ูพูุดู android ุขูุงุฏู ุดุฏู

๐ฑ ุจุฑุง ุณุงุฎุช APK:
   1. Android Studio ุฑุง ุจุงุฒ ฺฉูุฏ
   2. ุฏุณุชูุฑ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:
      npx cap open android
   3. ุฏุฑ Android Studio:
      - Build > Generate Signed Bundle / APK
      - APK ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ
      - ฺฉูุฏ ุงูุถุง ุงุฌุงุฏ/ุงูุชุฎุงุจ ฺฉูุฏ
      - APK ุฑุง ุจุณุงุฒุฏ

๐ ุฑุงูููุง ฺฉุงูู ุฏุฑ README-DEPLOYMENT.md ููุฌูุฏ ุงุณุช.

๐ ุชูุฒุน:
   - ูุจ: ูุงู ZIP ุฑุง extract ฺฉุฑุฏู ู ุฏุฑ ุณุฑูุฑ ุขูพููุฏ ฺฉูุฏ
   - ุงูุฏุฑูุฏ: APK ุฑุง ูุตุจ ฺฉูุฏ (ููุงุจุน ูุงุดูุงุฎุชู ุจุงุฏ ูุนุงู ุจุงุดุฏ)
"
